<!-- edit_table.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Edit DataFrame</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            background: linear-gradient(to bottom right, #FFD700, #FFA500);
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 100px;
        }

        h1 {
            color: #FFF;
            font-size: 36px;
        }

        table {
            margin-top: 50px;
            border-collapse: collapse;
            width: 100%;
            max-width: 800px;
            background-color: #FFF;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        table th, table td {
            padding: 10px;
            border-bottom: 1px solid #DDD;
        }

        table th {
            background-color: #FF6347;
            color: #FFF;
            font-weight: bold;
        }

        input[type="text"] {
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #DDD;
        }

        input[type="submit"] {
            margin-top: 20px;
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            background-color: #FF4500;
            color: #FFF;
            font-size: 18px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s;
            cursor: pointer;
            outline: none;
        }

        input[type="submit"]:hover {
            background-color: #FF6347;
        }

        input[type="submit"]:focus {
            background-color: #FF6347;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
    </style>

</head>
<body>
    <table id="data-table">
    </table>
    <script>
        // Retrieve the dataframe JSON from Flask
        var dfData = JSON.parse('{{ data | safe }}');

        // Create a function to render the editable table
        function renderTable() {
            var table = document.getElementById('data-table');

            // Clear existing table rows
            while (table.firstChild) {
                table.removeChild(table.firstChild);
            }

            // Create header row
            var headerRow = document.createElement('tr');
            for (var header in dfData[0]) {
                var headerCell = document.createElement('th');
                headerCell.textContent = header;
                headerRow.appendChild(headerCell);
            }
            table.appendChild(headerRow);

            // Create data rows
            for (var i = 0; i < dfData.length; i++) {
                var dataRow = document.createElement('tr');
                for (var column in dfData[i]) {
                    var dataCell = document.createElement('td');
                    var input = document.createElement('input');
                    input.type = 'text';
                    input.value = dfData[i][column];
                    dataCell.appendChild(input);
                    dataRow.appendChild(dataCell);
                }
                table.appendChild(dataRow);
            }
        }

        // Call the renderTable function to initially render the table
        renderTable();

        // Handle form submission
        $('form').on('submit', function (event) {
            event.preventDefault();

            // Create an empty array to store the edited data
            var editedData = [];

            // Retrieve the edited values from the table cells
            $('#data-table tbody tr').each(function () {
                var editedRow = {};
                $(this).find('input').each(function () {
                    var columnName = $(this).closest('td').index();
                    var columnValue = $(this).val();
                    editedRow[columnName] = columnValue;
                });
                editedData.push(editedRow);
            });

            // Convert the edited data array to JSON
            var editedDataJson = JSON.stringify(editedData);

            // Set the value of a hidden input field with the edited data JSON
            $('#edited-data').val(editedDataJson);

            // Submit the form to the /save route
            $(this).unbind('submit').submit();
        });
    </script>

    <form method="POST" action="/save">
        <input type="hidden" id="edited-data" name="edited_data">
        <button type="submit">Save</button>
    </form>
</body>
</html>
<!--<body>
    <h1>Edit DataFrame</h1>
    <form method="POST" action="/save">
        <table>
            {{ data | safe }}
        </table>
        <input type="submit" value="Submit">
    </form>
</body>
</html>-->

